{% extends "PurethinkCMSBundle::layout.html.twig" %}

{% block keywords %}
    {{ meta.SEOData.keyword|default(parent()) }}
{% endblock keywords %}

{% block description %}
    {{ meta.SEOData.description|default(parent()) }}
{% endblock description %}

{% block title %}
    {{ meta.SEOData.title|default(parent()) }}
{% endblock title %}

{% block icon %}
    {% if template.icon is not null %}
        <link rel="icon" type="image/x-icon" href="{{ asset(template.assetPath ~ '/' ~ template.icon) }}" />
    {% else %}
        <link rel="icon" type="image/x-icon" href="{{ asset('purethink.ico') }}" />
    {% endif %}
{% endblock %}

{% block stylesheets %}
    {{ parent() }}

    {% stylesheets
        '@PurethinkCMSBundle/Resources/public/css/article.css'
        filter='less,cssrewrite,uglifycss'
        output='css/article.css' %}
        <link rel="stylesheet" href="{{ asset_url }}" type="text/css" />
    {% endstylesheets %}

    {% for templateStyle in template.styles %}
        <link rel="stylesheet" type="text/css" href="{{ asset(templateStyle.allPath) }}">
    {% endfor %}

    {% if layout is not null %}
        {% for layoutStyle in layout.styles %}
            <link rel="stylesheet" type="text/css" href="{{ asset(layoutStyle.allPath) }}">
        {% endfor %}
    {% endif %}
{% endblock stylesheets %}

{% block javascripts %}
    {{ parent() }}

    {% javascripts
        '@PurethinkCMSBundle/Resources/public/js/cookies.js'
        filter="?uglifyjs2"
        output='js/frontend.js' %}
        <script src="{{ asset_url }}"></script>
    {% endjavascripts %}

    {% for templateScript in template.scripts %}
        <script src="{{ asset(templateScript.allPath) }}"></script>
    {% endfor %}

    {% if layout is not null %}
        {% for layoutScript in layout.scripts %}
            <script src="{{ asset(layoutScript.allPath) }}"></script>
        {% endfor %}
    {% endif %}

    {% if analytics is defined and analytics is not null %}
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', '{{ analytics }}', 'auto');
            ga('send', 'pageview');
        </script>
    {% endif %}
{% endblock javascripts %}

{% block body %}
    {{ parent() }}
{% endblock body %}

{% set component = {} %}

{% for position in layout.positions %}
    {% set componentSettings = {} %}

    {% if (position.positionSlug) %}
        {% set componentSettings = componentSettings | merge({ ('slug') : position.positionSlug}) %}
    {% endif %}

    {% if (position.path) %}
        {% set componentSettings = componentSettings | merge({ ('template') : template.scriptPath~":"~position.path}) %}
    {% endif %}

    {% set componentHelper = sonata_block_render({ "type": position.service, "settings": componentSettings }) %}

    {% set component = component | merge({ (position.slug) : componentHelper}) %}
{% endfor %}